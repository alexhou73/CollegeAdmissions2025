# 2025年全国大学招生数据可视化项目 - 完整用户指令记录

## 项目概述
基于Flask+Echarts开发的大学招生数据可视化大屏，分析Excel文件'2025.xlsx'中'普通批'页面的大学数据。

## 完整用户指令列表

### 第一阶段：项目初始化与数据读取 (2025-06-28)

1. 帮我写一段python程序，打开'2025.xlsx'文件，读取'普通批'页前30行数据

2. 继续

3. 3

4. 帮我创建可视化大屏分析'普通批'页面内的大学数据，主要根据学校的层次和省份位置来统计各省的大学数量。选择适合的图表样式，不超过5个，使用Flask+Echarts。希望加入中国行政区地图作为一个主要的图表显示

5. 层次在Excel中位于'普通批'页面内'层次'列，'省份'位于'普通批'页面内'位置'列

6. 启动服务

### 第二阶段：错误修复与功能完善

7. 加载页面失败：127.0.0.1/:1 Failed to load resource: the server responded with a status of 500 (INTERNAL SERVER ERROR)

8. 帮我自动执行命令

9. 加载错误：console log：china.js:1 Uncaught SyntaxError: Unexpected identifier 'Not' (at china.js:1:6) [详细错误信息]

10. 自动尝试用 unpkg 镜像下载，并修复

11. 下载官方 china.json 到 static/ 目录。修改地图加载方式：用ajax加载china.json并用echarts.registerMap注册中国地图，替换原china.js引用

12. 修改代码使得当鼠标悬浮在'各省大学数量分布'图表时，tooltip显示该省份有多少所大学。省份颜色按照大学数量填充颜色，从多到少分别为红、橙、黄、绿。注意检查是否存在省份的中英文不匹配的问题，如果有需要建立一个结构负责mapping

### 第三阶段：数据统计问题修复

13. 普通批大学分布大屏中显示的大学数量不对，现在所有的省份都显示'0所大学'，请检查mapping是不是有问题

14. 需要

15. 注意，如果同一位置有多所相同的学校名称，需要合并计算总数。

16. 鼠标悬浮在各省大学数量分布图表时仍然是0所大学。请检查并修改

17. 重启Flask服务

18. 仍然有问题，/api/province_level_stats的结构如下：{...}

19. 帮我自动修改并重启服务

### 第四阶段：界面优化与布局调整

20. 更新'各省大学数量'和'各省大学层次分布'这两个图表，使用饼图或者圈图展示

21. 删除'各省大学层次分布'

22. 修改'各省大学数量'图表，将详细说明部分简化 例： 上海市：27所（4.44%）简化为：上海市

23. 修改界面：移除'各省大学数量'和'大学层次占比'图表中的图例。重新编排界面，将三个图表放在同一行内，左侧是'各省大学分布'图表，占60%宽度，右侧从上到下分别是'各省大学数量'和'大学层次占比'

24. 将大屏名称改为'2025年全国大学（普通）招生情况'

### 第五阶段：顶部统计栏开发

25. 在大屏顶部加入数据统计栏，如大学总数、985、216、211等（与大学层次占比相同）

26. 美化顶部统计栏，目前的列名应该是：大学总数、985大学、双一流大学、211大学。使用浅蓝色或者灰色色调

27. 修改代码，当鼠标悬停在'各省大学数量'时显示tooltip该省的大学数量

28. 在顶部状态栏最后加入'招生总数'，数值取自Excel文件中每所大学的第一行（浅蓝色背景）的'25计划'列，底色为白色的行内数字不统计。

### 第六阶段：错误处理与服务重启

29. 加载页面失败，console log：GET http://127.0.0.1:5000/api/province_level_stats 500 (INTERNAL SERVER ERROR) [详细错误信息]

30. 请分析并修改

31. 需要

32. 在顶部统计栏的"211大学"和"招生总数"之间加入'公办大学'、'民办大学'的数量，另外加入'其它'，数量是大学总数减去985、216、211、公办、民办大学后的数量

33. 加载失败，Console信息：chrome-error://chromewebdata/:1 Failed to load resource: the server responded with a status of 403 ()

34. 是否需要重新启动应用和服务？

35. 帮我重新启动服务

36. 仍然有问题，请检查修改

37. 调整顶部信息栏宽度，缩小字体使得顶部信息栏与下边数据栏宽度一致

### 第七阶段：最新修改 (2025-06-29)

38. 将页面顶部信息栏中的'招生总数（班）'，改为'招生总数 *' 在'地图操作提示'内容右侧加如下信息："* 招生总数具体见底部大学详细信息"

39. 将'地图操作提示'内容右侧信息："* 招生总数具体见底部大学详细信息"后再添加'2025年计划招生总数'，使用蓝色黑体字表示

40. 将本次会话中我的所有命令存储到commands-0629.txt

41. 将本project中我的*全部*指令存放到commands.txt文件中

## 项目最终功能特性

### 数据可视化组件
- 中国地图：显示各省大学数量分布，支持缩放、拖拽、省份点击
- 各省大学数量环形图：显示各省大学数量对比
- 大学层次占比饼图：显示不同层次大学的占比情况

### 顶部统计栏
- 大学总数、985大学、双一流大学、211大学
- 公办大学、民办大学、其它
- 招生总数 * (支持省份切换显示)

### 交互功能
- 地图缩放、拖拽、省份点击查看详情
- 省份与全国视图切换
- 大学详细信息表格，支持分页和省份筛选
- 专业代码去重合并显示，每5个换行

### 技术栈
- 后端：Flask + pandas
- 前端：HTML + CSS + JavaScript + Echarts
- 数据源：Excel文件 (2025.xlsx)
- 地图数据：中国及各省份GeoJSON

## 开发过程中解决的主要问题
1. Echarts地图数据加载问题
2. 省份名称中英文映射问题
3. 数据统计去重逻辑
4. Flask版本兼容性问题
5. 专业代码合并显示
6. 顶部统计栏省份切换功能
7. 界面布局和响应式设计优化 